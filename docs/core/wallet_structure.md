---
name: Wallet Structure
description: 지갑 모듈의 구조와 책임 경계 정의 (판단 규칙)
---

# Wallet Structure

> **역할:** 이 문서는 기능 설명이 아니라 **판단 규칙**입니다.  
> 화면이 아니라 **구조와 책임 경계**를 정의합니다.

---

## 1. 모듈 책임 정의

지갑 모듈은 다음을 책임진다:
- 자산 잔고 조회
- 입금 주소 생성 및 관리
- 출금 요청 제출
- 입출금 내역 조회

지갑 모듈은 다음을 책임지지 않는다:
- 입출금 가능 여부 판단 (Core에서 수행)
- 블록체인 전송 실행 (Backend)
- 정책 적용 (Policy Layer)

---

## 2. 자산 구조 원칙

### 2.1 내부 원장 우선
- 내부 원장 잔고가 단일 진실 원천
- 블록체인 주소는 구현 수단
- 사용자는 자산을 직접 소유하지 않음

### 2.2 잔고 구성
- Total: 전체 잔고
- Available: 사용 가능 잔고
- In Orders: 주문 중 잔고
- Locked: 리스크/정책으로 잠긴 잔고

---

## 3. 책임 경계

### 3.1 지갑 모듈의 책임
- 잔고 표시
- 입금 주소 요청
- 출금 파라미터 입력 (주소, 수량, 네트워크)
- 입출금 상태 표시

### 3.2 Core/Policy의 책임
- 입출금 가능 여부 판단 (State/Policy/Risk)
- 한도 적용
- 수수료 계산
- 최종 승인/거부

---

## 4. 입금 구조

### 4.1 입금 플로우
1. 입금 주소 생성 요청
2. 블록체인 주소 할당
3. 사용자 외부 입금
4. 블록체인 확인 대기
5. 내부 원장 반영

### 4.2 입금 상태
- Pending (블록체인 확인 중)
- Confirmed (내부 원장 반영 완료)
- Failed (실패)

---

## 5. 출금 구조

### 5.1 출금 플로우
1. 출금 요청 제출
2. State/Policy/Risk 검증
3. 2FA 인증
4. 내부 원장 차감
5. 블록체인 전송
6. 완료 확인

### 5.2 출금 상태
- Pending (검증 중)
- Processing (전송 중)
- Completed (완료)
- Rejected (거부)
- Locked (보류)

---

## 6. 정책 적용 지점

### 6.1 출금 제한
- 일일/월간 출금 한도
- 최소 출금 금액
- 네트워크 수수료 정책
- KYC 수준별 한도

### 6.2 Pilot 단계 제약
- 출금 한도 축소
- 일부 자산 출금 제한
- 수동 검토 빈도 높음

---

## 7. 리스크 처리

### 7.1 리스크 발생 시나리오
- 의심스러운 출금 패턴
- 비정상적 주소
- 급격한 대량 출금

### 7.2 처리 원칙
- 즉시 출금 보류
- 운영팀 검토 필요
- 자동 해제 불가
- 보류 사유 명시

---

## 8. UI 구조 원칙

### 8.1 잔고 표시
- 테이블 형식 (Currency, Total, Available, In Orders, Locked)
- 검색 및 필터 기능
- 소액 자산 숨김 옵션

### 8.2 입출금 UI
- 네트워크 선택 명확히
- 최소/최대 금액 안내
- 수수료 명시
- 경고 문구 강조

---

## 9. 실패 처리 원칙

### 9.1 입금 실패
- 블록체인 확인 실패 시 상태 명시
- 재확인 메커니즘 제공
- 고객센터 연락 정보 제공

### 9.2 출금 실패
- 실패 사유 명확히 표시 (State/Policy/Risk 구분)
- 잔고 즉시 복구
- 재시도 옵션 제공 (가능한 경우)

---

## 10. 환경 불안정성 대응

### 10.1 네트워크 불안정
- 블록체인 확인 지연 시 명시
- 예상 시간 안내
- 진행 상황 실시간 표시

### 10.2 타임아웃 처리
- 상태 불명확 시 명시
- 재확인 옵션 제공
- 중복 제출 방지

---

## 11. AI 생성 시 준수 사항

지갑 모듈 생성 시 AI는:
- 입출금 가능 여부를 직접 판단하지 않음 (API 호출)
- 정책을 하드코딩하지 않음
- 리스크 판단을 자동화하지 않음
- 사용자가 자산을 "직접 소유"로 표현하지 않음
- 블록체인 주소를 "소유권"으로 설명하지 않음
