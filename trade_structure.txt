# CEX Trade Structure PRD (Skills용)

## 1. 문서 역할
본 문서는 CEX Core PRD 및 Onboarding Structure PRD를 전제로 한  
**거래(Trade) 모듈의 구조적 기준**을 정의한다.

본 문서는 UI 구성, 매칭 엔진 구현, API 상세를 정의하지 않으며,  
**거래 가능 여부 판단 흐름과 책임 경계**를 고정한다.

---

## 2. Trade 모듈의 정의와 범위

### 2.1 Trade 모듈 정의
Trade 모듈은 Account가 **자산을 매수·매도·주문 관리**할 수 있는 기능 집합이다.

Trade 모듈은 자산 소유를 의미하지 않으며,  
내부 원장 상의 잔고를 기준으로 거래를 수행한다.

---

### 2.2 Trade 모듈 포함 범위
- 주문 생성 (Buy / Sell)
- 주문 수정 및 취소
- 주문 상태 조회
- 체결 결과 반영 (잔고 변화)
- 거래 제한 및 차단 안내

---

### 2.3 Trade 모듈 제외 범위
- 계정 생성 및 인증
- KYC 수행
- 입금 및 출금 실행
- 지갑 주소 관리
- 매칭 엔진 내부 알고리즘

---

## 3. Trade 판단의 기본 원칙

### 3.1 Account 기준 원칙
- 모든 거래 판단은 Account 기준으로 수행한다.
- User(UI)는 판단 주체가 아니다.

---

### 3.2 상태 선행 원칙
- Trade 모듈은 상태(State)를 직접 변경하지 않는다.
- Trade 가능 여부 판단 시 Core PRD의 상태를 입력값으로 사용한다.

---

### 3.3 권한 계산 원칙
Trade 가능 여부는 반드시 다음 순서로 판단한다.
1. 상태(State)
2. 정책(Policy)
3. 리스크(Risk)

이 순서는 고정이며 변경할 수 없다.

---

## 4. Trade 접근 조건

### 4.1 기본 접근 조건
- Trade 모듈 접근은 온보딩 완료를 전제로 하지 않는다.
- 단, 실제 주문 실행은 정책 및 상태 조건을 충족해야 한다.

---

### 4.2 거래 가능 최소 상태
- 최소 요구 상태는 정책 레이어에서 정의한다.
- Trade 모듈은 정책 값을 참조만 하며 판단하지 않는다.

---

## 5. 주문(Order) 처리 구조

### 5.1 주문의 정의
- 주문은 Account의 거래 의사를 시스템에 전달하는 요청이다.
- 주문은 생성 즉시 체결되지 않을 수 있다.

---

### 5.2 주문 생성 규칙
주문 생성 시 다음 조건을 만족해야 한다.
- Trade 권한이 유효할 것
- 잔고가 충분할 것
- 리스크 상태가 정상일 것

조건 불충족 시 주문은 생성되지 않는다.

---

### 5.3 주문 상태 관리
- 주문은 독립적인 상태를 가진다.
- 주문 상태는 Account 상태와 분리하여 관리한다.

주문 상태 예:
- Created
- Open
- Partially Filled
- Filled
- Cancelled
- Rejected

---

## 6. 정책(Policy) 개입 지점 (Trade)

### 6.1 정책 개입 항목
정책은 다음 항목에 개입할 수 있다.
- 거래 가능 자산
- 주문 유형 제한
- 거래 금액 한도
- 레버리지 허용 여부

---

### 6.2 정책 적용 원칙
- 정책은 명시적 값으로만 적용된다.
- Trade 모듈은 정책을 해석하지 않는다.
- 정책 미충족 시 거래는 차단된다.

---

## 7. 리스크(Risk) 개입 규칙 (Trade)

### 7.1 리스크 개입 위치
- 주문 생성 전
- 주문 유지 중
- 체결 이후

---

### 7.2 리스크 발생 시 처리
- 신규 주문 차단
- 기존 주문 강제 취소 가능
- 거래 제한 사유 명확히 안내

리스크는 자동 해제되지 않는다.

---

## 8. 잔고(Balance) 처리 원칙

### 8.1 잔고 기준
- 거래에 사용되는 잔고는 내부 원장 기준이다.
- 외부 블록체인 상태와 직접 연동하지 않는다.

---

### 8.2 잔고 변경 시점
- 주문 체결 결과에 따라 잔고가 변경된다.
- 주문 생성만으로 잔고는 확정 차감되지 않는다.

---

## 9. UX 공통 규칙 (Trade)

### 9.1 거래 가능성 표현
- 거래 불가 시 버튼 숨김은 지양한다.
- 거래 제한 사유를 명확히 안내한다.

---

### 9.2 실패 및 거절 처리
- 실패는 시스템 오류가 아니라 **거절 사유**로 표현한다.
- 상태·정책·리스크 중 어떤 요인인지 구분한다.

---

## 10. AI 생성 시 금지 사항 (Trade)

AI는 다음을 수행해서는 안 된다.
- Trade 모듈에서 상태(State)를 직접 변경
- 정책을 추론하거나 보완
- DEX 거래 방식 혼입
- 사용자가 자산을 직접 소유하는 것처럼 표현

---

## 11. Trade 모듈 요약 기준
- Trade는 상태를 바꾸지 않는다.
- Trade는 권한을 계산한다.
- Trade는 잔고를 참조하고 결과를 반영한다.
- 모든 판단은 Account 기준이다.
- 본 문서는 Trade 모듈의 구조적 기준이다.