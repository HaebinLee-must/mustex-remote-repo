# CEX Wallet Structure PRD (Skills용)

## 1. 문서 역할
본 문서는 CEX Core PRD 및 Onboarding / Trade Structure PRD를 전제로 한  
**지갑(Wallet) 모듈의 구조적 기준**을 정의한다.

본 문서는 블록체인 연동 방식, 지갑 키 관리 구현, API 상세를 정의하지 않으며,  
**자산 판단 기준, 잔고 책임 범위, 입출금 제어 원칙**을 고정한다.

---

## 2. Wallet 모듈의 정의와 범위

### 2.1 Wallet 모듈 정의
Wallet 모듈은 Account가 보유한 **자산의 상태와 잔고를 관리하는 단일 진실 원천**이다.

Wallet은 자산 소유를 의미하지 않으며,  
Account가 서비스 내에서 자산을 **접근·사용·이동**할 수 있게 하는 관리 레이어다.

---

### 2.2 Wallet 모듈 포함 범위
- 내부 원장 기반 잔고 관리
- 자산별 가용 잔고 계산
- 입금 상태 반영
- 출금 가능 여부 판단
- 자산 이동 내역 조회
- 지갑 제한 및 락 상태 처리

---

### 2.3 Wallet 모듈 제외 범위
- 거래 체결 로직
- 매칭 엔진
- 온체인 키 생성·보관 방식
- 블록체인 네트워크 직접 제어
- KYC 검증 수행

---

## 3. Wallet 판단의 기본 원칙

### 3.1 Account 기준 원칙
- 모든 지갑 판단은 Account 기준으로 수행한다.
- User(UI)는 판단 주체가 아니다.

---

### 3.2 단일 진실 원천 원칙
- 내부 원장 잔고가 유일한 진실(Source of Truth)이다.
- 블록체인 상태는 참고 정보일 수 있으나 판단 기준이 아니다.

---

### 3.3 상태 불변 원칙
- Wallet 모듈은 Account의 상태(State)를 변경하지 않는다.
- Wallet은 상태를 입력값으로만 사용한다.

---

## 4. 잔고(Balance) 구조 원칙

### 4.1 잔고 유형
Wallet은 다음 잔고를 구분하여 관리한다.
- Total Balance
- Available Balance
- Locked Balance

---

### 4.2 잔고 계산 원칙
- Available Balance는 거래 및 출금 가능 기준 잔고다.
- Locked Balance는 주문, 출금 대기, 리스크로 인해 잠긴 잔고다.
- Wallet 모듈은 잔고 계산 결과를 Trade 모듈에 제공한다.

---

## 5. 입금(Deposit) 처리 구조

### 5.1 입금의 정의
입금은 외부 자산이 내부 원장에 **반영되는 과정**이다.

---

### 5.2 입금 처리 원칙
- 입금은 자동으로 Available Balance가 되지 않을 수 있다.
- 정책 또는 리스크에 따라 Locked 상태로 반영될 수 있다.
- 입금 완료 여부는 Wallet 모듈이 판단한다.

---

### 5.3 입금 상태 예시
- Detected
- Pending
- Confirmed
- Rejected

입금 상태는 Account 상태와 분리하여 관리한다.

---

## 6. 출금(Withdrawal) 처리 구조

### 6.1 출금의 정의
출금은 내부 원장 자산을 외부로 이동시키는 요청이다.

---

### 6.2 출금 가능 판단 순서
출금 가능 여부는 반드시 다음 순서로 판단한다.
1. 상태(State)
2. 정책(Policy)
3. 리스크(Risk)
4. 잔고(Available Balance)

---

### 6.3 출금 처리 원칙
- 출금 요청 시 해당 금액은 즉시 Locked Balance로 전환된다.
- 출금 실패 시 Locked 상태는 해제 또는 재처리된다.
- Wallet 모듈은 출금 실행 여부를 결정하되, 네트워크 실행은 담당하지 않는다.

---

## 7. 정책(Policy) 개입 지점 (Wallet)

### 7.1 정책 개입 항목
정책은 다음 항목에 개입할 수 있다.
- 출금 한도
- 자산별 출금 제한
- 출금 대기 시간
- 입금 반영 조건

---

### 7.2 정책 적용 원칙
- 정책은 명시적 값으로만 적용된다.
- Wallet 모듈은 정책을 해석하거나 보완하지 않는다.
- 정책 미충족 시 입출금은 차단된다.

---

## 8. 리스크(Risk) 개입 규칙 (Wallet)

### 8.1 리스크 개입 위치
- 입금 반영 전
- 출금 요청 시
- 자산 이동 중

---

### 8.2 리스크 발생 시 처리
- 입출금 중단
- 자산 Locked 유지
- 제한 사유 명확히 안내
- 운영 개입 요구

리스크는 자동 해제되지 않는다.

---

## 9. UX 공통 규칙 (Wallet)

### 9.1 잔고 가시성
- Total / Available / Locked 잔고를 명확히 구분하여 노출한다.
- 잔고 차이의 사유를 설명한다.

---

### 9.2 제한 상태 UX
- 입출금 불가 시 사유를 반드시 안내한다.
- 상태, 정책, 리스크 중 어떤 요인인지 구분하여 표시한다.

---

## 10. AI 생성 시 금지 사항 (Wallet)

AI는 다음을 수행해서는 안 된다.
- Wallet 모듈에서 Account 상태를 직접 변경
- 사용자가 블록체인 지갑을 직접 소유한다고 표현
- 정책을 추론하거나 보완
- Trade 모듈의 책임 영역 침범

---

## 11. Wallet 모듈 요약 기준
- Wallet은 자산의 진실 원천이다.
- Wallet은 잔고를 계산하고 제공한다.
- Wallet은 입출금 가능 여부를 판단한다.
- Wallet은 상태를 변경하지 않는다.
- 모든 판단은 Account 기준이다.
- 본 문서는 Wallet 모듈의 구조적 기준이다.